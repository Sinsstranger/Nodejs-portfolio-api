/* eslint-disable no-unused-expressions */
!(function frontInit() {
	const BACKEND_HOST = 'http://localhost:8080';
	document.addEventListener('DOMContentLoaded', async () => {
		const stackRequestUri = '/api/stack';
		const getData = async (url) => {
			try {
				const response = await fetch(url);
				if (!response.ok) {
					throw new Error(response.statusText);
				}
				return await response.json();
			} catch (error) {
				// eslint-disable-next-line no-console
				console.log(error);
				return false;
			}
		};
		const getStacks = async () => {
			const stacks = await getData(BACKEND_HOST + stackRequestUri);
			return stacks;
		};
		const stackTechnologies = await getStacks();
		const $usuallyUsedStackContainer = document.querySelector('[data-tech-stack-usual="true"]') || null;
		const $unUsuallyUsedStackContainer = document.querySelector('[data-tech-stack-usual="false"]') || null;
		if ($usuallyUsedStackContainer && $unUsuallyUsedStackContainer) {
			stackTechnologies.forEach(({ imagePath, title, isUsuallyUsed }) => {
				const techItemTag = `<div class="tech-stack__ico"><img src="${imagePath}" alt="${title}"></div>`;
				const $container = isUsuallyUsed ? $usuallyUsedStackContainer : $unUsuallyUsedStackContainer;
				$container.insertAdjacentHTML('beforeend', techItemTag);
			});
		}
		const $loginForm = document.querySelector('.login-form');
		if ($loginForm) {
			$loginForm.addEventListener('submit', async (e) => {
				e.preventDefault();
				const data = new FormData(e.target);
				const res = await fetch(window.location.origin + e.target.getAttribute('action'), {
					method: 'POST',
					headers: {
						// contentType: 'application/x-www-form-urlencoded',
						'Content-Type': 'application/json',
					},
					body: JSON.stringify({
						email: data.get('email'),
						password: data.get('password'),
					}),
				});
				if (res.ok) {
					// eslint-disable-next-line no-console
					console.log(await res.json());
					window.location.href = '/';
				}
			});
		}
	});
})();
